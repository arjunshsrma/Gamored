<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gamored — UPI Checkout</title>
<link rel="icon" href="favicon.ico">
<style>
:root{
  --bg-main:#05070c;
  --bg-panel:#0b1c2d;
  --bg-soft:#081a2e;
  --accent:#00c6ff;
  --accent-2:#0072ff;
  --text-main:#e8f2ff;
  --text-muted:#9fdcff;
  --border-glow:rgba(0,170,255,0.35);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  background:linear-gradient(#05070c,#081a2e);
  color:var(--text-main);
  line-height:1.5;
}

/* ===== NAV ===== */
.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 6%;
  background:#0b1c2d;
  box-shadow:0 6px 20px rgba(0,0,0,.4);
}

.nav a{
  color:var(--text-main);
  text-decoration:none;
  margin:0 14px;
  font-weight:600;
}

.nav a:hover{
  color:var(--accent);
}

/* ===== CARD ===== */
.checkout-card{
  max-width:780px;
  margin:60px auto;
  padding:36px;
  background:linear-gradient(135deg,var(--bg-panel),var(--bg-soft));
  border-radius:22px;
  box-shadow:0 0 40px rgba(0,170,255,.25);
}

.checkout-card h2{
  color:var(--text-muted);
  margin-top:0;
}

/* ===== SECTIONS ===== */
.card{
  padding:20px 24px;
  border-radius:16px;
  background:rgba(10,30,60,.7);
  border:1px solid var(--border-glow);
  margin-bottom:24px;
}

h3{
  color:var(--text-muted);
  margin-top:0;
}

/* ===== QR ===== */
.qr{
  display:flex;
  justify-content:center;
  margin:24px 0;
}

.qr img{
  width:180px;
  height:180px;
  padding:10px;
  border-radius:16px;
  background:#ffffff;
}

/* ===== FORM ===== */
label{
  display:block;
  margin-top:14px;
  font-weight:600;
  color:var(--text-muted);
}

input,
select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid var(--border-glow);
  background:#0b1c2d;
  color:var(--text-main);
}

input::placeholder{
  color:#7fbfff;
}

.grid-2{
  display:grid;
  gap:14px;
  grid-template-columns:repeat(2,1fr);
}

@media(max-width:640px){
  .grid-2{grid-template-columns:1fr}
}

/* ===== BUTTON ===== */
.btn-primary{
  margin-top:30px;
  padding:16px 38px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#00121f;
  border:none;
  border-radius:16px;
  cursor:pointer;
  font-weight:700;
  font-size:16px;
}

.btn-primary:hover{
  filter:brightness(1.1);
}

/* ===== TOAST ===== */
.toast{
  margin-top:18px;
  padding:14px 18px;
  border-radius:12px;
  font-weight:600;
}

.ok{
  background:rgba(0,255,160,.15);
  border:1px solid rgba(0,255,160,.4);
}

.err{
  background:rgba(255,80,80,.15);
  border:1px solid rgba(255,80,80,.4);
}

</style>
</head>
<body>
<nav class="nav">
<div class="logo"><a href="index.html">Gamored</a></div>
<div>
<a href="index.html">Home</a>
<a href="Laptopaccessories.html">Products</a>
<a href="cart.html">Cart</a>
</div>
</nav>

<section class="checkout-card">
<h2>UPI Checkout</h2>

<div id="order-summary" class="card">
<h3>Order Summary</h3>
<p><strong>Amount:</strong> ₹<span id="amountValue">0</span></p>
<p><strong>Items:</strong> <span id="itemCount">0</span></p>
</div>

<div class="qr">
<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=7042630996@fam&pn=Gamored&cu=INR&am=0" id="upiQR" alt="UPI QR">
</div>
<p style="text-align:center;">Scan the QR above or <a id="upiLink" href="#" style="color:var(--accent);font-weight:600;">click here to pay via UPI app</a></p>

<form id="upiCheckoutForm">
<h3>Contact Details</h3>
<label for="fullName">Full Name</label>
<input id="fullName" name="fullName" type="text" required>
<label for="email">Email</label>
<input id="email" name="email" type="email" required>
<label for="phone">Phone</label>
<input id="phone" name="phone" type="tel" pattern="[0-9]{10}" required>

<h3>Address Details</h3>
<div class="grid-2">
<div><label for="state">State</label><input id="state" name="state" type="text" required></div>
<div><label for="city">City</label><input id="city" name="city" type="text" required></div>
<div><label for="pincode">Pincode</label><input id="pincode" name="pincode" type="text" pattern="[0-9]{6}" required></div>
<div><label for="houseNo">House No./Building</label><input id="houseNo" name="houseNo" type="text" required></div>
</div>
<label for="address1">Address Line 1</label>
<input id="address1" name="address1" type="text" required>
<label for="address2">Address Line 2</label>
<input id="address2" name="address2" type="text">
<div class="grid-2">
<div><label for="landmark">Landmark</label><input id="landmark" name="landmark" type="text"></div>
<div><label for="addressType">Address Type</label>
<select id="addressType" name="addressType"><option>Home</option><option>Office</option><option>Other</option></select></div>
</div>

<h3>Payment Proof</h3>
<label for="upiRef">UPI Transaction ID</label>
<input id="upiRef" name="upiRef" type="text" placeholder="e.g., UTR / Ref No." required>
<p>Upload your payment screenshot (PNG/JPG)</p>
<input id="screenshot" name="screenshot" type="file" accept="image/*" required>
<div id="shotPreview" style="margin-top:8px;"></div>

<input type="hidden" id="orderAmount" name="orderAmount" value="">
<input type="hidden" id="orderItemsJson" name="orderItemsJson" value="[]">
<input type="hidden" id="orderId" name="orderId" value="">

<button type="submit" id="sendBtn" class="btn-primary">Send</button>
<div id="formMsg" class="toast" style="display:none;"></div>
</form>
</section>

<script>
(function(){
  try{
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const amount = cart.reduce((s,i)=>s+(i.price||0)*(i.qty||1),0);

    document.getElementById('amountValue').textContent = amount.toFixed(2);
    document.getElementById('itemCount').textContent = cart.length;
    document.getElementById('orderAmount').value = amount.toFixed(2);
    document.getElementById('orderItemsJson').value = JSON.stringify(cart);
    document.getElementById('orderId').value = 'GAMO-' + Date.now();

    const base = `upi://pay?pa=7042630996@fam&pn=Gamored&cu=INR&am=${amount.toFixed(2)}`;
    const qr = document.getElementById('upiQR');
    const link = document.getElementById('upiLink');

    qr.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(base)}`;
    link.href = base;
  } catch(e){}
})();

/* ===== Screenshot preview ===== */
const shotInput = document.getElementById('screenshot');
const shotPreview = document.getElementById('shotPreview');

shotInput.addEventListener('change', () => {
  shotPreview.innerHTML = '';
  const file = shotInput.files && shotInput.files[0];
  if (!file) return;

  if (file.size > 10 * 1024 * 1024) {
    alert('File too large');
    shotInput.value = '';
    return;
  }

  const img = document.createElement('img');
  img.style.maxWidth = '220px';
  img.style.borderRadius = '8px';
  img.src = URL.createObjectURL(file);
  shotPreview.appendChild(img);
});

/* ===== File → base64 ===== */
const fileToBase64 = (file) => new Promise((resolve, reject) => {
  const r = new FileReader();
  r.onload = () => resolve(String(r.result).split(',')[1]);
  r.onerror = reject;
  r.readAsDataURL(file);
});

const GAS_URL = 'https://script.google.com/macros/s/AKfycbyILp17k86wL1zw2deDcb2QoBWGkjFZYKSigC5jGm8GDpJh1b1F_gtWIsKSBcZTIhlXgw/exec';

/* ===== Form submit ===== */
document.getElementById('upiCheckoutForm').addEventListener('submit', async e => {
  e.preventDefault();

  const btn = document.getElementById('sendBtn');
  const msg = document.getElementById('formMsg');

  btn.disabled = true;
  btn.textContent = 'Sending...';
  msg.style.display = 'none';
  msg.className = 'toast';

  try{
    const file = shotInput.files && shotInput.files[0];
    if (!file) throw new Error('Attach a screenshot.');

    const b64 = await fileToBase64(file);

    const formEl = e.target;
    const fd = new FormData(formEl);
    fd.delete('screenshot');
    fd.append('screenshot_b64', b64);
    fd.append('screenshot_name', file.name || 'payment.png');
    fd.append('screenshot_type', file.type || 'image/png');

    const res = await fetch(GAS_URL, { method:'POST', body: fd });
    const text = await res.text();
    if (!res.ok) throw new Error(`HTTP ${res.status}: ${text.slice(0,200)}`);

msg.textContent = 'Submitted! We will confirm shortly.';
msg.className = 'toast ok';
msg.style.display = 'block';

/* ✅ SAVE ORDER ID FOR SUCCESS PAGE FALLBACK */
const orderId = document.getElementById('orderId').value;
localStorage.setItem("lastOrderId", orderId);

/* Redirect to success page */
setTimeout(() => {
  window.location.href =
    'order-success.html?orderId=' + encodeURIComponent(orderId);
}, 1800);


  } catch(err){
    msg.textContent = `Send failed → ${err.message}`;
    msg.className = 'toast err';
    msg.style.display = 'block';
    btn.disabled = false;
    btn.textContent = 'Send';
  }
});
</script>

</body>
</html>
